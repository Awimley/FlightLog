(function(){angular.module("flightApp",["ngRoute","ngSanitize","ui.bootstrap","LocalStorageModule"]);e.$inject=["$routeProvider","$locationProvider","localStorageServiceProvider"];function e(e,t,o){e.when("/",{templateUrl:"login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/home",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/logs",{templateUrl:"common/views/logs.view.html",controller:"logsCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true);o.setStorageType("localStorage")}angular.module("flightApp").config(["$routeProvider","$locationProvider","localStorageServiceProvider",e])})();(function(){angular.module("flightApp").controller("homeCtrl",e);e.$inject=["$modal","$scope","flightData","$log"];function e(e,t,o,r){var n=this;n.lastInspection="December 2015";n.pageHeader={title:"N562D App (angular edition!)",strapline:""};var a=new Date;a=a.toISOString();a=a.slice(5,7)+"/"+a.slice(8,10)+"/"+a.slice(2,4);o.flightData().success(function(e){n.data={flight:e[e.length-1]}}).error(function(e){console.log(e)});n.popupAddForm=function(){var t=e.open({templateUrl:"/modals/addModal.view.html",controller:"addModalCtrl as vm",resolve:{flight:function(){return{flt_date:a,hobbs_out:n.data.flight.hobbsIn}}}});t.result.then(function(e){o.flightData().success(function(e){n.data={flight:e[e.length-1]}}).error(function(e){console.log(e)})})}}})();(function(){angular.module("flightApp").controller("logsCtrl",e);e.$inject=["$routeParams","$modal","$scope","flightData","$log","$timeout"];function e(e,t,o,r,n,a){var i=this;var l=new Date;l=l.toISOString();l=l.slice(5,7)+"/"+l.slice(8,10)+"/"+l.slice(2,4);i.pageHeader={title:"Logs",strapline:l};r.flightData().success(function(e){i.data={flights:e.reverse()}}).error(function(e){console.log(e)});i.popupUpdateForm=function(e){var o=e.currentTarget.attributes["id"].value;r.flight(o).success(function(e){n.debug(e);var o=t.open({templateUrl:"/modals/updateModal.view.html",controller:"updateModalCtrl as vm",resolve:{flight:function(){return{flight:e}}}});o.result.then(function(e){a(function(){r.flightData().success(function(e){i.data={flights:e.reverse()}}).error(function(e){n.debug(e)})},600)})}).error(function(e){n.debug(e)})};i.popupAddForm=function(){var e=t.open({templateUrl:"/modals/addModal.view.html",controller:"addModalCtrl as vm",resolve:{flight:function(){return{flt_date:l,hobbs_out:i.data.flights[0].hobbsIn}}}});e.result.then(function(e){a(function(){r.flightData().success(function(e){i.data={flights:e.reverse()}}).error(function(e){n.debug(e)})},600)})}}})();(function(){angular.module("flightApp").controller("updateModalCtrl",e);e.$inject=["$modalInstance","flight","flightData","$log"];function e(e,t,o,r){var n=this;n.formError="";n.data=t.flight;n.onSubmit=function(){if(!n.data.flt_date||!n.data.hobbs_out||!n.data.fuel_out||!n.data.oil_dipstick||n.data.oil_dipstick>12||n.data.fuel_purch>114||n.data.oil_change>1||n.data.oil_change<0){n.formError="Hobbs and fuel out, Date, and Oil Dipstick (< 12 quarts) are required! (also fuel purch must be < 114, oil change 0 or 1)";return false}else{o.updateFlight(n.data);n.formError="";r.debug(n.data);e.close()}};n.deleteFlight=function(){o.deleteFlight(n.data._id);e.close()};n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("flightApp").controller("addModalCtrl",e);e.$inject=["$modalInstance","flight","flightData","$log"];function e(e,t,o,r){var n=this;n.formError="";n.data=t;n.onSubmit=function(){if(!n.data.flt_date||!n.data.hobbs_out||!n.data.fuel_out||!n.data.oil_dipstick||n.data.oil_dipstick>12||n.data.fuel_purch>114||n.data.oil_change>1||n.data.oil_change<0){n.formError="Hobbs and fuel out, Date, and Oil Dipstick (< 12 quarts) are required! (also fuel purch must be < 114, oil change 0 or 1)";return false}else{n.formError="";r.debug(n.data);n.doAdd(n.data);n.modal.close()}};n.doAdd=function(e){o.addFlight(e).success(function(e){n.modal.close()}).error(function(e){n.formError="Oops, something went wrong! Try again."})};n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("flightApp").controller("loginCtrl",e);e.$inject=["$location","$scope","flightData","$log","localStorageService","$location"];function e(e,t,o,r,n,e){var a=this;a.data={};a.res={};a.data=n.cookie.get("token");r.debug(a.data);a.pageHeader={title:"N562D App",strapline:"Have a nice flight!"};a.verifyUser=function(){o.verifyUser(a.data).success(function(t){if(t=="true"){e.url("home");r.debug(t)}}).error(function(e){console.log(e)})};a.login=function(){o.tryLogin(a.data.user,a.data.password).success(function(e){a.res=e;n.cookie.set("token",a.res);a.data=a.res;a.verifyUser()}).error(function(e){console.log(e);a.res=e;n.cookie.set("token",a.res)})};if(a.data){a.verifyUser()}}})();(function(){angular.module("flightApp").service("flightData",e);e.$inject=["$http","$log"];function e(e,t){var o=function(e){e.hobbs_in=e.hobbs_in||0;e.fuel_in=e.fuel_in||0;e.fuel_purch=e.fuel_purch||0;e.fuel_cost=e.fuel_cost||0;e.oil_added=e.oil_added||0;e.oil_dipstick=e.oil_dipstick||0;e.comment=e.comment||null;e.oil_change=e.oil_change||0;return e};var r=function(){return e.get("/loglist")};var n=function(t){if(t){return e.get("/findone/"+t)}else{return null}};var a=function(t){if(t){t=o(t);return e.post("/logadd",t)}else{return null}};var i=function(t){if(t){t=o(t);return e.put("/logupdate/"+t._id,t)}else{return null}};var l=function(t){if(t){return e.get("/logupdate/delete/"+t)}else{return null}};var c=function(t,o){var r={user:t,password:o};var n={headers:{"Content-type":"application/json"}};return e.post("/login",r,n)};var u=function(t){var t={user:t.user,token:t.token};var o={headers:{"Content-type":"application/json"}};return e.post("/verifyUser",t,o)};return{flightData:r,flight:n,addFlight:a,deleteFlight:l,updateFlight:i,tryLogin:c,verifyUser:u}}})();(function(){angular.module("flightApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var o,r;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);r="km"}else{o=parseInt(t*1e3,10);r="m"}return o+r}else{return"?"}}}})();(function(){angular.module("flightApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace("/\n/g","<br/>");return t}}})();(function(){angular.module("flightApp").directive("navigation",e);e.$inject=["$modal","flightData"];function e(e,t){var o=this;return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("flightApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("flightApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(e,t,o){"use strict";var r=t.isDefined,n=t.isUndefined,a=t.isNumber,i=t.isObject,l=t.isArray,c=t.extend,u=t.toJson,s=t.fromJson;function f(e){return/^-?\d+\.?\d*$/.test(e.replace(/["']/g,""))}var d=t.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:true,removeItem:false};this.setPrefix=function(e){this.prefix=e;return this};this.setStorageType=function(e){this.storageType=e;return this};this.setStorageCookie=function(e,t){this.cookie={expiry:e,path:t};return this};this.setStorageCookieDomain=function(e){this.cookie.domain=e;return this};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t};return this};this.$get=["$rootScope","$window","$document","$parse",function(e,t,o,d){var g=this;var h=g.prefix;var p=g.cookie;var m=g.notify;var v=g.storageType;var b;if(!o){o=document}else if(o[0]){o=o[0]}if(h.substr(-1)!=="."){h=!!h?h+".":""}var S=function(e){return h+e};var _=function(){try{var o=v in t&&t[v]!==null;var r=S("__"+Math.round(Math.random()*1e7));if(o){b=t[v];b.setItem(r,"");b.removeItem(r)}return o}catch(n){v="cookie";e.$broadcast("LocalStorageModule.notification.error",n.message);return false}}();var $=function(t,o){if(n(o)){o=null}else if(i(o)||l(o)||a(+o||o)){o=u(o)}if(!_||g.storageType==="cookie"){if(!_){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}if(m.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:"cookie"})}return w(t,o)}try{if(i(o)||l(o)){o=u(o)}if(b){b.setItem(S(t),o)}if(m.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:g.storageType})}}catch(r){e.$broadcast("LocalStorageModule.notification.error",r.message);return w(t,o)}return true};var y=function(t){if(!_||g.storageType==="cookie"){if(!_){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}return D(t)}var o=b?b.getItem(S(t)):null;if(!o||o==="null"){return null}if(o.charAt(0)==="{"||o.charAt(0)==="["||f(o)){return s(o)}return o};var k=function(t){if(!_||g.storageType==="cookie"){if(!_){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}if(m.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"})}return L(t)}try{b.removeItem(S(t));if(m.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:g.storageType})}}catch(o){e.$broadcast("LocalStorageModule.notification.error",o.message);return L(t)}return true};var T=function(){if(!_){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return false}var t=h.length;var o=[];for(var r in b){if(r.substr(0,t)===h){try{o.push(r.substr(t))}catch(n){e.$broadcast("LocalStorageModule.notification.error",n.Description);return[]}}}return o};var A=function(t){t=t||"";var o=h.slice(0,-1);var r=new RegExp(o+"."+t);if(!_||g.storageType==="cookie"){if(!_){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}return M()}var n=h.length;for(var a in b){if(r.test(a)){try{k(a.substr(n))}catch(i){e.$broadcast("LocalStorageModule.notification.error",i.message);return M()}}}return true};var O=function(){try{return t.navigator.cookieEnabled||"cookie"in o&&(o.cookie.length>0||(o.cookie="test").indexOf.call(o.cookie,"test")>-1)}catch(r){e.$broadcast("LocalStorageModule.notification.error",r.message);return false}}();var w=function(t,r){if(n(r)){return false}else if(l(r)||i(r)){r=u(r)}if(!O){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}try{var a="",c=new Date,s="";if(r===null){c.setTime(c.getTime()+-1*24*60*60*1e3);a="; expires="+c.toGMTString();r=""}else if(p.expiry!==0){c.setTime(c.getTime()+p.expiry*24*60*60*1e3);a="; expires="+c.toGMTString()}if(!!t){var f="; path="+p.path;if(p.domain){s="; domain="+p.domain}o.cookie=S(t)+"="+encodeURIComponent(r)+a+f+s}}catch(d){e.$broadcast("LocalStorageModule.notification.error",d.message);return false}return true};var D=function(t){if(!O){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}var r=o.cookie&&o.cookie.split(";")||[];for(var n=0;n<r.length;n++){var a=r[n];while(a.charAt(0)===" "){a=a.substring(1,a.length)}if(a.indexOf(S(t)+"=")===0){var i=decodeURIComponent(a.substring(h.length+t.length+1,a.length));try{var l=JSON.parse(i);return s(l)}catch(c){return i}}}return null};var L=function(e){w(e,null)};var M=function(){var e=null,t=null;var r=h.length;var n=o.cookie.split(";");for(var a=0;a<n.length;a++){e=n[a];while(e.charAt(0)===" "){e=e.substring(1,e.length)}var i=e.substring(r,e.indexOf("="));L(i)}};var E=function(){return v};var U=function(e,t,o,n){n=n||t;var a=y(n);if(a===null&&r(o)){a=o}else if(i(a)&&i(o)){a=c(o,a)}d(t).assign(e,a);return e.$watch(t,function(e){$(n,e)},i(e[t]))};var I=function(){var e=0;var o=t[v];for(var r=0;r<o.length;r++){if(o.key(r).indexOf(h)===0){e++}}return e};return{isSupported:_,getStorageType:E,set:$,add:$,get:y,keys:T,remove:k,clearAll:A,bind:U,deriveKey:S,length:I,cookie:{isSupported:O,set:w,add:w,get:D,remove:L,clearAll:M}}}]})})(window,window.angular);